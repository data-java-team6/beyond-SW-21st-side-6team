<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team6.dva.repository.UserMapper">

    <!-- 로그인 -->
    <select id="login" resultType="com.team6.dva.model.User">
        SELECT
        member_no     AS memberNo,
        member_id     AS memberId,
        member_pw     AS memberPw,
        balance       AS balance,
        member_name   AS memberName
        FROM tbl_member
        WHERE member_id = #{ id }
        AND member_pw = #{ pw }
    </select>

    <!-- 예치금 조회 -->
    <select id="showMyDeposit" resultType="int">
        SELECT balance
        FROM tbl_member
        WHERE member_id = #{ memberId }
    </select>

    <!-- ID 중복 체크 -->
    <select id="checkDuplicatedId" resultType="int">
        SELECT COUNT(*)
        FROM tbl_member
        WHERE member_id = #{ memberId }
    </select>

    <!-- 회원 가입 -->
    <insert id="insertUser">
        INSERT INTO tbl_member
        (member_id, member_pw, member_name, balance)
        VALUES
        (#{ memberId }, #{ memberPw }, #{ memberName }, #{ balance })
    </insert>

    <select id="selectUserById" resultType="com.team6.dva.model.User">
        SELECT
        member_no
        , member_id
        , member_pw
        , balance
        , member_name
        FROM tbl_member
        WHERE member_id = #{memberId}
    </select>

    <select id="showMyConcert"
            parameterType="string"
            resultType="com.team6.dva.model.Payment">
        SELECT
        sh.show_name    AS showName,
        sh.show_date    AS showDate,
        s.seat_name     AS seatName,
        p.total_price   AS totalPrice
        FROM tbl_payment p
        JOIN tbl_member m ON p.member_no = m.member_no
        JOIN tbl_seat   s ON p.seat_id   = s.seat_id
        JOIN tbl_show  sh ON s.show_no   = sh.show_no   <!-- 컬럼명이 show_id면 여기만 바꾸기 -->
        WHERE m.member_id = #{memberId}            <!-- ② WHERE 나중에 -->
    </select>

</mapper>